-- [[ ç§¦å§‹çš‡ - è¬ä¸–é–‹å¹³ V41 ]]

local UI_TAG = "Qin_Final_V41"
local S_CG = game:GetService("CoreGui")
if S_CG:FindFirstChild(UI_TAG) then S_CG[UI_TAG]:Destroy(); getgenv().StopLoops = true; task.wait(0.1) end
getgenv().StopLoops = false

local S_PL, S_RS, S_ST, S_REP, S_UI = game:GetService("Players"), game:GetService("RunService"), game:GetService("Stats"), game:GetService("ReplicatedStorage"), game:GetService("UserInputService")
local LP = S_PL.LocalPlayer
local Camera = workspace.CurrentCamera

-- [[ 1. æ ¸å¿ƒé…ç½® ]]
getgenv().CaiHuaConfig = {
    Toggles = { 
        FastAttack = false, AttackMonsters = false, AttackPlayers = false, AttackAll = false, 
        SpeedActive = false, JumpActive = false, AutoV4 = false,
        ESP_Main = false, ESP_NameDist = false, ESP_Health = false, ESP_Tracer = false
    },
    Settings = { AtkRange = 500, ClickDelay = 0.1, WalkSpd = 16, JumpPower = 50, FOV = 70 }
}

-- [[ 2. UI æ¡†æ¶ ]]
local SG = Instance.new("ScreenGui", S_CG); SG.Name = UI_TAG; SG.ResetOnSpawn = false
local function ApplyROG(obj, thick)
    local stroke = Instance.new("UIStroke", obj); stroke.Thickness = thick; stroke.ApplyStrokeMode = "Border"
    task.spawn(function() while not getgenv().StopLoops and task.wait(0.01) do stroke.Color = Color3.fromHSV(tick() % 5 / 5, 0.8, 1) end end)
end

local Main = Instance.new("Frame", SG); Main.BackgroundColor3 = Color3.fromRGB(15, 15, 20); Main.Position = UDim2.new(0.5, -250, 0.5, -180); Main.Size = UDim2.new(0, 500, 0, 380); Main.BorderSizePixel = 0; Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 12); ApplyROG(Main, 3)
local Side = Instance.new("Frame", Main); Side.Size = UDim2.new(0, 130, 1, 0); Side.BackgroundColor3 = Color3.fromRGB(22, 22, 28); Instance.new("UICorner", Side)
Instance.new("UIListLayout", Side).HorizontalAlignment = "Center"; Instance.new("UIPadding", Side).PaddingTop = UDim.new(0, 10)

-- é›™åç¨±é¡¯ç¤º
local UserPart = Instance.new("Frame", Side); UserPart.Size = UDim2.new(1, 0, 0, 95); UserPart.BackgroundTransparency = 1
local Avatar = Instance.new("ImageLabel", UserPart); Avatar.Size = UDim2.new(0, 40, 0, 40); Avatar.Position = UDim2.new(0.5, -20, 0, 0); Avatar.Image = "rbxthumb://type=AvatarHeadShot&id="..LP.UserId.."&w=150&h=150"; Instance.new("UICorner", Avatar).CornerRadius = UDim.new(1,0)
local DN = Instance.new("TextLabel", UserPart); DN.Size = UDim2.new(1,0,0,15); DN.Position = UDim2.new(0,0,0,45); DN.Text = LP.DisplayName; DN.TextColor3 = Color3.new(1,1,1); DN.Font = "GothamBold"; DN.TextSize = 10; DN.BackgroundTransparency = 1
local UN = Instance.new("TextLabel", UserPart); UN.Size = UDim2.new(1,0,0,12); UN.Position = UDim2.new(0,0,0,60); UN.Text = "@"..LP.Name; UN.TextColor3 = Color3.fromRGB(180, 180, 180); UN.Font = "Gotham"; UN.TextSize = 8; UN.BackgroundTransparency = 1

local Container = Instance.new("Frame", Main); Container.Position = UDim2.new(0, 140, 0, 10); Container.Size = UDim2.new(1, -150, 1, -20); Container.BackgroundTransparency = 1
local Tabs = {}
local function CreateTab(name)
    local F = Instance.new("ScrollingFrame", Container); F.Size = UDim2.new(1, 0, 1, 0); F.BackgroundTransparency = 1; F.Visible = false; F.ScrollBarThickness = 2; F.AutomaticCanvasSize = "Y"
    Instance.new("UIListLayout", F).Padding = UDim.new(0, 8)
    local B = Instance.new("TextButton", Side); B.Size = UDim2.new(0.9, 0, 0, 28); B.BackgroundColor3 = Color3.fromRGB(35, 35, 45); B.Text = name; B.TextColor3 = Color3.new(1,1,1); B.Font = "GothamBold"; B.TextSize = 10; Instance.new("UICorner", B)
    B.MouseButton1Click:Connect(function() for _, v in pairs(Tabs) do v.Visible = false end; F.Visible = true end)
    table.insert(Tabs, F); return F
end

-- é€šç”¨çµ„ä»¶
local function AddToggle(p, t, f)
    local B = Instance.new("TextButton", p); B.Size = UDim2.new(0.95, 0, 0, 32); B.BackgroundColor3 = Color3.fromRGB(45, 45, 55); B.Text = t.." [OFF]"; B.TextColor3 = Color3.new(1,1,1); B.Font = "GothamBold"; B.TextSize = 11; Instance.new("UICorner", B)
    B.MouseButton1Click:Connect(function() if type(f) == "string" then getgenv().CaiHuaConfig.Toggles[f] = not getgenv().CaiHuaConfig.Toggles[f]; B.Text = t..(getgenv().CaiHuaConfig.Toggles[f] and " [ON]" or " [OFF]"); B.BackgroundColor3 = getgenv().CaiHuaConfig.Toggles[f] and Color3.fromRGB(120, 30, 30) or Color3.fromRGB(45, 45, 55) else f() end end)
end
local function AddSlider(p, t, min, max, def, isDec, cb)
    local F = Instance.new("Frame", p); F.Size = UDim2.new(0.95, 0, 0, 45); F.BackgroundTransparency = 1
    local L = Instance.new("TextLabel", F); L.Size = UDim2.new(1,0,0,15); L.Text = t..": "..def; L.TextColor3 = Color3.new(1,1,1); L.Font = "GothamBold"; L.TextSize = 10; L.BackgroundTransparency = 1; L.TextXAlignment = "Left"
    local B = Instance.new("TextButton", F); B.Size = UDim2.new(1,0,0,6); B.Position = UDim2.new(0,0,0,25); B.BackgroundColor3 = Color3.fromRGB(60,60,70); B.Text = ""; Instance.new("UICorner", B)
    local S = Instance.new("Frame", B); S.Size = UDim2.new((def-min)/(max-min), 0, 1, 0); S.BackgroundColor3 = Color3.new(1,1,1); Instance.new("UICorner", S)
    B.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then local m; m = S_UI.InputChanged:Connect(function(i2) if i2.UserInputType == Enum.UserInputType.MouseMovement or i2.UserInputType == Enum.UserInputType.Touch then local pVal = math.clamp((i2.Position.X - B.AbsolutePosition.X) / B.AbsoluteSize.X, 0, 1); S.Size = UDim2.new(pVal, 0, 1, 0); local val = min + (max - min) * pVal; val = isDec and math.floor(val*100)/100 or math.floor(val); L.Text = t..": "..val; cb(val) end end) S_UI.InputEnded:Connect(function(i3) if i3.UserInputType == Enum.UserInputType.MouseButton1 or i3.UserInputType == Enum.UserInputType.Touch then m:Disconnect() end end) end end)
end

-- [[ 3. åˆ†é å…§å®¹ ]]
local T_Notice = CreateTab("ğŸ“œ å…¬å‘Šèˆ‡é—œé–‰")
local T_Combat = CreateTab("âš”ï¸ ç§’æ®ºè¨­ç½®")
local T_Player = CreateTab("ğŸƒ ç©å®¶ä¿®æ”¹")
local T_ESP = CreateTab("ğŸ‘ï¸ é€è¦–(åƒ…ç©å®¶)")
local T_Scripts = CreateTab("ğŸ“‚ å¤–éƒ¨è…³æœ¬")

-- å…¬å‘Š
local function AddLab(p,t,c) local l = Instance.new("TextLabel", p); l.Size = UDim2.new(1,0,0,25); l.Text=t; l.TextColor3=c or Color3.new(1,1,1); l.Font="GothamBold"; l.TextSize=12; l.BackgroundTransparency=1 end
AddLab(T_Notice, "ç§¦å§‹çš‡è£½ä½œ", Color3.new(1,1,0))
AddLab(T_Notice, "ç‹€æ…‹: æ¸¬è©¦ä¸­...", Color3.fromRGB(255, 100, 100))
AddToggle(T_Notice, "ğŸ›‘ å¾¹åº•é—œé–‰ä¸¦åˆªé™¤ UI", function() getgenv().StopLoops = true; SG:Destroy() end)

-- ç§’æ®º
AddToggle(T_Combat, "é–‹å•Ÿå¿«é€Ÿæ”»æ“Š", "FastAttack")
AddSlider(T_Combat, "æ”»æ“Šé€Ÿåº¦", 0.01, 0.5, 0.1, true, function(v) getgenv().CaiHuaConfig.Settings.ClickDelay = v end)
AddSlider(T_Combat, "ç§’æ®ºç¯„åœ", 100, 5000, 500, false, function(v) getgenv().CaiHuaConfig.Settings.AtkRange = v end)
AddToggle(T_Combat, "æ‰“å°æ€ª", "AttackMonsters"); AddToggle(T_Combat, "æ‰“ç©å®¶", "AttackPlayers"); AddToggle(T_Combat, "å…¨éƒ¨éƒ½æ‰“ (é€šæ®º)", "AttackAll")

-- ä¿®æ”¹
AddToggle(T_Player, "è‡ªå‹• V4 è¦ºé†’", "AutoV4")
AddToggle(T_Player, "é–‹å•Ÿé€Ÿåº¦ä¿®æ”¹", "SpeedActive"); AddSlider(T_Player, "ç§»å‹•é€Ÿåº¦", 16, 500, 16, false, function(v) getgenv().CaiHuaConfig.Settings.WalkSpd = v end)
AddToggle(T_Player, "é–‹å•Ÿè·³èºä¿®æ”¹", "JumpActive"); AddSlider(T_Player, "è·³èºé«˜åº¦", 50, 500, 50, false, function(v) getgenv().CaiHuaConfig.Settings.JumpPower = v end)

-- é€è¦– (åƒ…é™ç©å®¶ç©å®¶)
AddToggle(T_ESP, "ç©å®¶é€è¦–ç¸½é–‹é—œ", "ESP_Main")
AddToggle(T_ESP, "é¡¯ç¤ºåç¨±è·é›¢", "ESP_NameDist")
AddToggle(T_ESP, "é¡¯ç¤ºè¡€é‡", "ESP_Health")
AddToggle(T_ESP, "é–‹å•Ÿ ROG é€£ç·š", "ESP_Tracer")
AddSlider(T_ESP, "è¦–è§’ FOV", 70, 150, 70, false, function(v) getgenv().CaiHuaConfig.Settings.FOV = v end)

-- å¤–éƒ¨è…³æœ¬ (æ–°å¢ XA)
local function ATB(p, t, f) local B = Instance.new("TextButton", p); B.Size = UDim2.new(0.95, 0, 0, 30); B.BackgroundColor3 = Color3.fromRGB(40,40,50); B.Text = t; B.TextColor3 = Color3.new(1,1,1); B.Font="GothamBold"; B.TextSize=11; Instance.new("UICorner", B); B.MouseButton1Click:Connect(f) end
ATB(T_Scripts, "ğŸ”¥ XA ä»£ç¢¼", function() loadstring(game:HttpGet("https://raw.githubusercontent.com/iqiq180jush-cell/Xuan/refs/heads/main/XA"))() end)
ATB(T_Scripts, "ğŸš€ P è…³æœ¬", function() loadstring(game:HttpGet("https://raw.githubusercontent.com/iqiq180jush-cell/Xuan/refs/heads/main/p"))() end)
ATB(T_Scripts, "âš¡ FPS å„ªåŒ–", function() loadstring(game:HttpGet("https://raw.githubusercontent.com/iqiq180jush-cell/Xuan/refs/heads/main/FPPS"))() end)
ATB(T_Scripts, "ğŸ•Šï¸ GG é£›è¡Œå™¨", function() loadstring(game:HttpGet("https://raw.githubusercontent.com/iqiq180jash-afk/Xuan/refs/heads/main/%E9%A3%9B%E8%A1%8C"))() end)

-- [[ 4. ç›£æ§é¢æ¿ (ç½®ä¸­) ]]
local MonF = Instance.new("Frame", SG); MonF.Size = UDim2.new(0, 200, 0, 160); MonF.Position = UDim2.new(0.8, 0, 0.4, 0); MonF.BackgroundColor3 = Color3.fromRGB(10,10,15); MonF.Visible = false; Instance.new("UICorner", MonF); ApplyROG(MonF, 2)
Instance.new("UIListLayout", MonF).HorizontalAlignment = "Center"
local function ML(t, c) local l = Instance.new("TextLabel", MonF); l.Size = UDim2.new(1,0,0,22); l.BackgroundTransparency=1; l.TextColor3= c or Color3.new(1,1,1); l.Font="Code"; l.TextSize=11; l.Text=t; l.TextXAlignment = "Center"; return l end
local mFPS = ML("FPS: --", Color3.new(0,1,0.5)); local mPing = ML("Ping: --", Color3.new(1,0.8,0)); local mMem = ML("å…§å­˜: -- MB", Color3.new(0,0.8,1)); local mExec = ML("æ³¨å…¥å™¨: "..(identifyexecutor and identifyexecutor() or "æœªçŸ¥"), Color3.new(1,0.4,0.4)); local mDev = ML("è£ç½®: "..((S_UI.TouchEnabled and not S_UI.MouseEnabled) and "æ‰‹æ©Ÿ" or "é›»è…¦"), Color3.new(0.7,0.7,0.7))
local SideMonBtn = Instance.new("TextButton", Side); SideMonBtn.Size = UDim2.new(0.9, 0, 0, 30); SideMonBtn.BackgroundColor3 = Color3.fromRGB(180, 50, 50); SideMonBtn.Text = "âš¡ å¯¦æ™‚ç›£æ¸¬"; SideMonBtn.TextColor3 = Color3.new(1,1,1); SideMonBtn.Font = "GothamBold"; SideMonBtn.TextSize = 10; Instance.new("UICorner", SideMonBtn); SideMonBtn.MouseButton1Click:Connect(function() MonF.Visible = not MonF.Visible end)

-- [[ 5. æ ¸å¿ƒé‚è¼¯ (åƒ…ç©å®¶ ESP) ]]
local function CreateESP(obj)
    if not obj or not S_PL:GetPlayerFromCharacter(obj) or obj == LP.Character then return end -- åš´æ ¼éæ¿¾: å¿…é ˆæ˜¯ç©å®¶è§’è‰²
    local head = obj:WaitForChild("Head", 5); local hum = obj:WaitForChild("Humanoid", 5)
    if not head or not hum then return end
    local bg = Instance.new("BillboardGui", head); bg.Size = UDim2.new(0, 100, 0, 40); bg.StudsOffset = Vector3.new(0, 3, 0); bg.AlwaysOnTop = true
    local nL = Instance.new("TextLabel", bg); nL.Size = UDim2.new(1,0,0.5,0); nL.BackgroundTransparency=1; nL.TextColor3=Color3.new(1,1,1); nL.TextScaled=true; nL.Text=obj.Name
    local hL = Instance.new("TextLabel", bg); hL.Size = UDim2.new(1,0,0.5,0); hL.Position=UDim2.new(0,0,0.5,0); hL.BackgroundTransparency=1; hL.TextScaled=true
    local line = Drawing.new("Line"); line.Thickness=2; line.Transparency=0.8; line.Visible=false
    local conn; conn = S_RS.RenderStepped:Connect(function()
        if getgenv().StopLoops or not obj.Parent or hum.Health <= 0 or not getgenv().CaiHuaConfig.Toggles.ESP_Main then 
            bg.Enabled = false; line.Visible = false; if getgenv().StopLoops then conn:Disconnect() end return 
        end
        bg.Enabled = true; nL.Visible = getgenv().CaiHuaConfig.Toggles.ESP_NameDist; hL.Visible = getgenv().CaiHuaConfig.Toggles.ESP_Health; nL.Text = obj.Name.." ["..math.floor(LP:DistanceFromCharacter(obj.PrimaryPart.Position)).."m]"
        local p = hum.Health/hum.MaxHealth; hL.TextColor3 = p > 0.7 and Color3.new(0,1,0) or (p > 0.3 and Color3.new(1,1,0) or Color3.new(1,0,0)); hL.Text = "HP: "..math.floor(hum.Health)
        if getgenv().CaiHuaConfig.Toggles.ESP_Tracer then
            local pos, vis = Camera:WorldToViewportPoint(obj.PrimaryPart.Position)
            if vis then line.Visible=true; line.From=Vector2.new(Camera.ViewportSize.X/2, 0); line.To=Vector2.new(pos.X, pos.Y); line.Color=Color3.fromHSV(tick()%5/5,0.8,1) else line.Visible=false end
        else line.Visible=false end
    end)
end

S_PL.PlayerAdded:Connect(function(p) p.CharacterAdded:Connect(function(c) CreateESP(c) end) end)
for _,v in pairs(S_PL:GetPlayers()) do if v ~= LP and v.Character then CreateESP(v.Character) end end

S_RS.RenderStepped:Connect(function()
    if getgenv().StopLoops then return end
    Camera.FieldOfView = getgenv().CaiHuaConfig.Settings.FOV
    if MonF.Visible then mFPS.Text = "FPS: "..math.floor(workspace:GetRealPhysicsFPS()); mPing.Text = "Ping: "..math.floor(S_ST.Network.ServerStatsItem["Data Ping"]:GetValue()).."ms"; mMem.Text = "å…§å­˜: "..math.floor(S_ST:GetTotalMemoryUsageMb()).." MB" end
    pcall(function()
        local H = LP.Character.Humanoid
        H.WalkSpeed = getgenv().CaiHuaConfig.Toggles.SpeedActive and getgenv().CaiHuaConfig.Settings.WalkSpd or 16
        H.JumpPower = getgenv().CaiHuaConfig.Toggles.JumpActive and getgenv().CaiHuaConfig.Settings.JumpPower or 50
        if getgenv().CaiHuaConfig.Toggles.AutoV4 then local v4 = LP.Backpack:FindFirstChild("Awakening") or LP.Character:FindFirstChild("Awakening") if v4 then v4.RemoteFunction:InvokeServer(true) end end
    end)
end)

task.spawn(function()
    local RA = S_REP:WaitForChild("Modules"):WaitForChild("Net"):WaitForChild("RE/RegisterAttack")
    local RH = S_REP.Modules.Net:WaitForChild("RE/RegisterHit")
    while not getgenv().StopLoops and task.wait() do
        if getgenv().CaiHuaConfig.Toggles.FastAttack then
            pcall(function()
                local ts = {}
                local function sc(f) for _,e in pairs(f:GetChildren()) do if e:FindFirstChild("Humanoid") and e.Humanoid.Health > 0 and LP:DistanceFromCharacter(e.PrimaryPart.Position) < getgenv().CaiHuaConfig.Settings.AtkRange then table.insert(ts, {e, e.PrimaryPart}) end end end
                if getgenv().CaiHuaConfig.Toggles.AttackAll then sc(workspace.Enemies); sc(workspace.Characters) elseif getgenv().CaiHuaConfig.Toggles.AttackMonsters then sc(workspace.Enemies) elseif getgenv().CaiHuaConfig.Toggles.AttackPlayers then sc(workspace.Characters) end
                if #ts > 0 then RA:FireServer(getgenv().CaiHuaConfig.Settings.ClickDelay); RH:FireServer(ts[1][2], ts) end
            end)
        end
        task.wait(getgenv().CaiHuaConfig.Settings.ClickDelay)
    end
end)

local CaiHuaBtn = Instance.new("TextButton", SG); CaiHuaBtn.Size = UDim2.new(0, 60, 0, 60); CaiHuaBtn.Position = UDim2.new(0, 30, 0, 30); CaiHuaBtn.BackgroundColor3 = Color3.new(0,0,0); CaiHuaBtn.Text = "ğŸ¥¦"; CaiHuaBtn.TextSize = 35; Instance.new("UICorner", CaiHuaBtn).CornerRadius = UDim.new(1,0); ApplyROG(CaiHuaBtn, 4)
CaiHuaBtn.MouseButton1Click:Connect(function() Main.Visible = not Main.Visible end)
local function Drag(o) local g, s, sp; o.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then g = true; s = i.Position; sp = o.Position end end) o.InputChanged:Connect(function(i) if g and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then local d = i.Position - s; o.Position = UDim2.new(sp.X.Scale, sp.X.Offset + d.X, sp.Y.Scale, sp.Y.Offset + d.Y) end end) o.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then g = false end end) end
Drag(Main); Drag(MonF); Drag(CaiHuaBtn)
Tabs[1].Visible = true
